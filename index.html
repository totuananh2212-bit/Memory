<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wol - Website</title>
<style>
  :root{--bg:#071718;--panel:rgba(255,255,255,0.03);--accent:#0aa089;--muted:#9fb8af;--danger:#ef6b6b}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);color:#e8fff6;
    background-image:url('https://i.ibb.co/8x2Qx6W/leaf-pattern.png');background-size:cover;background-attachment:fixed}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(90deg,#021818,#002b2b)}
  header h1{margin:0;font-size:18px}
  nav{display:flex;gap:8px;padding:10px;background:#002f2f;justify-content:center}
  nav button{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted);padding:8px 12px;border-radius:8px;cursor:pointer}
  nav button.active{background:var(--accent);color:#021;font-weight:700}
  main{display:flex;gap:14px;padding:14px}
  aside{width:260px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(0,0,0,0.25),rgba(0,0,0,0.18));border:1px solid rgba(255,255,255,0.03);height:calc(100vh-130px);overflow:auto}
  section.content{flex:1;height:calc(100vh-130px);overflow:auto;padding:12px}
  .card{background:var(--panel);padding:12px;border-radius:8px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.02)}
  input[type=text],input[type=email],textarea,select{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;margin-top:8px}
  textarea{min-height:90px;resize:vertical}
  .btn{background:var(--accent);border:none;color:#021;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .posts{display:flex;flex-direction:column;gap:12px;margin-top:12px}
  .post{padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15));border:1px solid rgba(255,255,255,0.03)}
  .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
  .mediaRow{display:flex;flex-wrap:wrap;gap:8px}
  img.preview{max-width:220px;border-radius:8px}
  video.preview{max-width:320px;border-radius:8px}
  .actions{display:flex;gap:8px;align-items:center;margin-top:10px}
  .reaction{padding:6px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;background:transparent;color:var(--muted)}
  .comment-box{margin-top:12px;border-top:1px dashed rgba(255,255,255,0.03);padding-top:10px}
  .comment{display:flex;justify-content:space-between;gap:8px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.01)}
  .small{font-size:13px;color:var(--muted)}
  .danger{color:var(--danger);cursor:pointer}
  #notif{position:fixed;right:12px;bottom:12px;background:#0b2f2f;padding:10px;border-radius:8px;display:none;color:#bff3e6}
  footer{padding:12px;text-align:center;color:var(--muted)}
  @media(max-width:900px){aside{display:none}main{padding:8px}}
</style>
</head>
<body>
<header>
  <div style="display:flex;gap:12px;align-items:center">
    <img src="https://i.ibb.co/H4rF6zq/leaf-icon.png" alt="logo" style="width:44px;height:44px;border-radius:8px">
    <div>
      <h1 id="siteTitle">Wol ‚Äî Khu v∆∞·ªùn s·ªë</h1>
      <div class="small">M√†u xanh ƒë·∫≠m ‚Ä¢ L∆∞u c·ª•c b·ªô (localStorage)</div>
    </div>
  </div>
  <div class="small">T√†i kho·∫£n c√†i ƒë·∫∑t: <b>Toanh2212</b> / <b>22012000</b></div>
</header>

<nav id="mainNav">
  <button data-tab="tab-media" class="active">1. ·∫¢nh & Video</button>
  <button data-tab="tab-profile">2. Th√¥ng tin c√° nh√¢n</button>
  <button data-tab="tab-reviews">3. ƒê√°nh gi√°</button>
  <button data-tab="tab-settings">‚öôÔ∏è C√†i ƒë·∫∑t</button>
</nav>

<main>
  <aside>
    <div class="card">
      <div class="small">T√™n m·∫∑c ƒë·ªãnh khi b√¨nh lu·∫≠n (t√πy ch·ªçn)</div>
      <input id="defaultName" placeholder="V√≠ d·ª•: Kh√°ch v√£ng lai">
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" onclick="saveDefaultName()">L∆∞u</button>
        <button class="btn ghost" onclick="clearDefaultName()">X√≥a</button>
      </div>
    </div>

    <div class="card">
      <div class="small">Backup / Restore</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" onclick="exportData()">Xu·∫•t JSON</button>
        <input id="importFile" type="file" accept=".json" onchange="importData(event)">
      </div>
      <div class="small" style="margin-top:8px">L∆∞u file backup ƒë·ªÉ kh√¥i ph·ª•c khi c·∫ßn.</div>
    </div>

    <div class="card">
      <div class="small">X√≥a to√†n b·ªô d·ªØ li·ªáu (localStorage)</div>
      <div style="margin-top:8px">
        <button class="btn ghost" onclick="wipeAll()">X√ìA TO√ÄN B·ªò</button>
      </div>
    </div>
  </aside>

  <section class="content">
    <!-- TAB Media -->
    <div id="tab-media" class="card tab active">
      <h2>1. ·∫¢nh & Video ‚Äî T·∫£i l√™n t·ª´ m√°y</h2>
      <div class="small">Ch·ªçn nhi·ªÅu file (image/video). L∆∞u s·∫Ω chuy·ªÉn th√†nh DataURL ƒë·ªÉ gi·ªØ khi tho√°t.</div>
      <label class="small" style="margin-top:8px">M√¥ t·∫£</label>
      <textarea id="mediaDesc" placeholder="Ghi m√¥ t·∫£..."></textarea>
      <label class="small" style="margin-top:8px">Ch·ªçn file (multiple)</label>
      <input id="mediaFiles" type="file" accept="image/*,video/*" multiple>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" onclick="addMediaPost()">ƒêƒÉng & L∆∞u</button>
        <button class="btn ghost" onclick="renderMediaPosts()">L√†m m·ªõi</button>
      </div>

      <div id="mediaPosts" class="posts"></div>
    </div>

    <!-- TAB Profile -->
    <div id="tab-profile" class="card tab" style="display:none">
      <h2>2. Th√¥ng tin c√° nh√¢n</h2>
      <input id="profileName" placeholder="H·ªç t√™n">
      <input id="profilePhone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
      <input id="profileEmail" placeholder="Email">
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" onclick="saveProfile()">L∆∞u</button>
        <button class="btn ghost" onclick="clearProfile()">X√≥a</button>
      </div>
      <div id="profileShow" class="card small" style="margin-top:12px">Ch∆∞a c√≥ th√¥ng tin.</div>
    </div>

    <!-- TAB Reviews -->
    <div id="tab-reviews" class="card tab" style="display:none">
      <h2>3. ƒê√°nh gi√° website (1‚Äì5 sao)</h2>
      <label class="small">S·ªë sao</label>
      <select id="reviewStars"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option></select>
      <textarea id="reviewText" placeholder="Nh·∫≠n x√©t..."></textarea>
      <label class="small">·∫¢nh minh h·ªça (t√πy ch·ªçn)</label>
      <input id="reviewFile" type="file" accept="image/*">
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" onclick="addReview()">G·ª≠i ƒë√°nh gi√°</button>
        <button class="btn ghost" onclick="renderReviews()">L√†m m·ªõi</button>
      </div>

      <div id="reviewsList" class="posts"></div>
    </div>

    <!-- TAB Settings -->
    <div id="tab-settings" class="card tab" style="display:none">
      <h2>‚öôÔ∏è C√†i ƒë·∫∑t (ƒëƒÉng nh·∫≠p c·∫ßn thi·∫øt)</h2>
      <div id="loginArea" class="card">
        <input id="loginUser" placeholder="T√†i kho·∫£n">
        <input id="loginPass" placeholder="M·∫≠t kh·∫©u" type="password">
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn" onclick="doLogin()">ƒêƒÉng nh·∫≠p</button>
          <button class="btn ghost" onclick="doLogout()">ƒêƒÉng xu·∫•t</button>
        </div>
        <div id="loginStatus" class="small" style="margin-top:8px">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
      </div>

      <div id="settingsArea" class="card">
        <label class="small">Ti√™u ƒë·ªÅ website</label>
        <input id="newTitle" placeholder="Ti√™u ƒë·ªÅ m·ªõi...">
        <label class="small" style="margin-top:8px">·∫¢nh n·ªÅn (t·∫£i file ho·∫∑c d√°n link)</label>
        <input id="bgFile" type="file" accept="image/*">
        <input id="bgUrl" placeholder="Ho·∫∑c d√°n link ·∫£nh n·ªÅn...">
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn" onclick="applySettings()">√Åp d·ª•ng</button>
        </div>
        <div class="small" style="margin-top:8px">(Ch·ªâ ng∆∞·ªùi ƒëƒÉng nh·∫≠p m·ªõi thay ƒë·ªïi ƒë∆∞·ª£c)</div>
      </div>
    </div>
  </section>
</main>

<div id="notif"></div>
<footer>All data saved to <b>localStorage</b>. Export JSON ƒë·ªÉ backup.</footer>

<script>
/* ======= Keys & helpers ======= */
const KEY = {DATA:'wol_site_data_v2', DEFAULT_NAME:'wol_default_name_v2', SETTINGS:'wol_settings_v2'};
const AUTH={user:'Toanh2212',pass:'22012000'};

function load(key){ try{ return JSON.parse(localStorage.getItem(key)||'null') }catch(e){ return null } }
function save(key,val){ try{ localStorage.setItem(key, JSON.stringify(val)); return true }catch(e){ notify('Kh√¥ng th·ªÉ l∆∞u: d·ªØ li·ªáu qu√° l·ªõn'); return false } }
function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,6) }
function notify(msg, timeout=2000){ const n=document.getElementById('notif'); n.innerText=msg; n.style.display='block'; setTimeout(()=>n.style.display='none', timeout); }

/* ======= Data init ======= */
let data = load(KEY.DATA) || { media: [], profile: null, reviews: [] };
let settings = load(KEY.SETTINGS) || { title: document.getElementById('siteTitle').innerText, bg: null };

/* Apply saved settings */
if(settings.title) document.getElementById('siteTitle').innerText = settings.title;
if(settings.bg) document.body.style.backgroundImage = `url('${settings.bg}')`;

/* Navigation */
document.querySelectorAll('#mainNav button').forEach(b=>{
  b.addEventListener('click', ()=>{
    document.querySelectorAll('#mainNav button').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    const tab = b.dataset.tab;
    document.querySelectorAll('.tab').forEach(t=>t.style.display='none');
    document.getElementById(tab).style.display='block';
    if(tab==='tab-media') renderMediaPosts();
    if(tab==='tab-profile') renderProfile();
    if(tab==='tab-reviews') renderReviews();
    if(tab==='tab-settings') { document.getElementById('loginStatus').innerText = sessionStorage.getItem('wol_logged')==='1' ? 'ƒê√£ ƒëƒÉng nh·∫≠p' : 'Ch∆∞a ƒëƒÉng nh·∫≠p' }
  });
});

/* ======= Default name functions ======= */
function saveDefaultName(){ const v=document.getElementById('defaultName').value.trim(); if(!v){ notify('Nh·∫≠p t√™n ƒë·ªÉ l∆∞u'); return } ; save(KEY.DEFAULT_NAME,v); notify('ƒê√£ l∆∞u t√™n m·∫∑c ƒë·ªãnh') }
function clearDefaultName(){ localStorage.removeItem(KEY.DEFAULT_NAME); document.getElementById('defaultName').value=''; notify('ƒê√£ x√≥a t√™n m·∫∑c ƒë·ªãnh') }
function getDefaultName(){ return load(KEY.DEFAULT_NAME) || 'Kh√°ch' }

/* ======= Media tab ======= */
/* read files to DataURL */
function fileListToDataUrls(files){
  const arr = Array.from(files);
  const promises = arr.map(f => new Promise((res,rej)=>{
    const fr = new FileReader();
    fr.onload = ()=> res({name:f.name,type:f.type,data:fr.result});
    fr.onerror = rej;
    fr.readAsDataURL(f);
  }));
  return Promise.all(promises);
}

async function addMediaPost(){
  const desc = document.getElementById('mediaDesc').value.trim();
  const input = document.getElementById('mediaFiles');
  const files = input.files;
  if(files.length===0 && !desc){ notify('C·∫ßn m√¥ t·∫£ ho·∫∑c file'); return; }
  try{
    const filesData = await fileListToDataUrls(files);
    const post = { id: uid(), desc, files: filesData, created: new Date().toISOString(), likes:0, dislikes:0, loves:0, comments: [] };
    data.media.unshift(post);
    if(save(KEY.DATA,data)){ document.getElementById('mediaDesc').value=''; document.getElementById('mediaFiles').value=''; notify('ƒê√£ l∆∞u b√†i ƒëƒÉng'); renderMediaPosts(); }
  }catch(e){ console.error(e); notify('L·ªói ƒë·ªçc file'); }
}

function renderMediaPosts(){
  const container = document.getElementById('mediaPosts'); container.innerHTML='';
  for(const p of data.media){
    const d = document.createElement('div'); d.className='post';
    let html = `<div class="meta"><strong>${escapeHtml(p.desc||'')}</strong> <span class="small">‚Ä¢ ${new Date(p.created).toLocaleString()}</span></div>`;
    if(p.files && p.files.length){
      html += `<div class="mediaRow">`;
      for(const f of p.files){
        if(f.type.startsWith('image')) html += `<img class="preview" src="${f.data}" alt="${escapeHtml(f.name)}">`;
        else if(f.type.startsWith('video')) html += `<video class="preview" controls src="${f.data}"></video>`;
        else html += `<div class="small">File: ${escapeHtml(f.name)}</div>`;
      }
      html += `</div>`;
    }
    html += `<div class="actions">
      <button class="reaction" onclick="mediaReact('${p.id}','likes')">üëç <span class="small">${p.likes}</span></button>
      <button class="reaction" onclick="mediaReact('${p.id}','dislikes')">üëé <span class="small">${p.dislikes}</span></button>
      <button class="reaction" onclick="mediaReact('${p.id}','loves')">‚ù§Ô∏è <span class="small">${p.loves}</span></button>
      <div style="margin-left:auto" class="small">
        <button class="btn ghost" onclick="editMediaDesc('${p.id}')">S·ª≠a</button>
        <button class="btn ghost danger" onclick="deleteMediaPost('${p.id}')">X√≥a</button>
      </div>
    </div>`;
    // comments area
    html += `<div class="comment-box" id="cbox_${p.id}">
      <div id="c_list_${p.id}"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <input id="cname_${p.id}" placeholder="T√™n (t√πy √Ω)" style="flex:0 0 180px">
        <input id="ctext_${p.id}" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." style="flex:1">
        <button class="btn" onclick="addMediaComment('${p.id}')">G·ª≠i</button>
      </div>
    </div>`;
    d.innerHTML = html;
    container.appendChild(d);
    renderMediaComments(p.id);
  }
}

function mediaReact(id, field){
  const p = data.media.find(x=>x.id===id); if(!p) return;
  p[field] = (p[field]||0) + 1; if(save(KEY.DATA,data)) renderMediaPosts();
}
function editMediaDesc(id){
  const p = data.media.find(x=>x.id===id); if(!p) return;
  const nv = prompt('S·ª≠a m√¥ t·∫£:', p.desc||'') ?? p.desc;
  p.desc = nv; if(save(KEY.DATA,data)) renderMediaPosts();
}
function deleteMediaPost(id){
  if(!confirm('X√°c nh·∫≠n x√≥a b√†i ƒëƒÉng?')) return;
  data.media = data.media.filter(x=>x.id!==id); if(save(KEY.DATA,data)) renderMediaPosts();
}

/* comments */
function addMediaComment(postId){
  const nameEl = document.getElementById(`cname_${postId}`); const txtEl = document.getElementById(`ctext_${postId}`);
  const name = (nameEl.value||'').trim() || getDefaultName(); const text = (txtEl.value||'').trim();
  if(!text) return notify('Vi·∫øt b√¨nh lu·∫≠n');
  const p = data.media.find(x=>x.id===postId); if(!p) return;
  p.comments.push({ id: uid(), name, text, t: new Date().toISOString(), likes:0, dislikes:0, loves:0 });
  if(save(KEY.DATA,data)){ nameEl.value=''; txtEl.value=''; renderMediaComments(postId); }
}
function renderMediaComments(postId){
  const p = data.media.find(x=>x.id===postId); const box = document.getElementById(`c_list_${postId}`);
  if(!p){ if(box) box.innerHTML=''; return; }
  box.innerHTML = '';
  for(const c of p.comments){
    const el = document.createElement('div'); el.className='comment';
    el.innerHTML = `<div><b>${escapeHtml(c.name)}</b> ‚Ä¢ <span class="small">${new Date(c.t).toLocaleString()}</span><div>${escapeHtml(c.text)}</div></div>
      <div style="text-align:right;min-width:160px">
        <button class="reaction" onclick="mediaCommentReact('${postId}','${c.id}','likes')">üëç <span class="small">${c.likes||0}</span></button>
        <button class="reaction" onclick="mediaCommentReact('${postId}','${c.id}','dislikes')">üëé <span class="small">${c.dislikes||0}</span></button>
        <button class="reaction" onclick="mediaCommentReact('${postId}','${c.id}','loves')">‚ù§Ô∏è <span class="small">${c.loves||0}</span></button>
        <div style="margin-top:6px"><button class="btn ghost danger" onclick="deleteMediaComment('${postId}','${c.id}')">X√≥a</button></div>
      </div>`;
    box.appendChild(el);
  }
}
function mediaCommentReact(postId, cid, field){
  const p = data.media.find(x=>x.id===postId); if(!p) return; const c = p.comments.find(x=>x.id===cid); if(!c) return;
  c[field] = (c[field]||0) + 1; if(save(KEY.DATA,data)) renderMediaComments(postId);
}
function deleteMediaComment(postId, cid){
  if(!confirm('X√≥a b√¨nh lu·∫≠n?')) return;
  const p = data.media.find(x=>x.id===postId); if(!p) return; p.comments = p.comments.filter(x=>x.id!==cid);
  if(save(KEY.DATA,data)) renderMediaComments(postId);
}

/* ======= Profile tab ======= */
function saveProfile(){
  const name = document.getElementById('profileName').value.trim();
  if(!name) return notify('Nh·∫≠p h·ªç t√™n');
  const phone = document.getElementById('profilePhone').value.trim();
  const email = document.getElementById('profileEmail').value.trim();
  data.profile = { name, phone, email, saved: new Date().toISOString() };
  if(save(KEY.DATA,data)) { notify('ƒê√£ l∆∞u th√¥ng tin'); renderProfile(); }
}
function clearProfile(){ if(!confirm('X√≥a th√¥ng tin c√° nh√¢n?')) return; data.profile = null; save(KEY.DATA,data); renderProfile(); }
function renderProfile(){
  const p = data.profile;
  const el = document.getElementById('profileShow');
  if(!p){ el.innerHTML = 'Ch∆∞a c√≥ th√¥ng tin.'; document.getElementById('profileName').value=''; document.getElementById('profilePhone').value=''; document.getElementById('profileEmail').value=''; return; }
  el.innerHTML = `<div><b>${escapeHtml(p.name)}</b></div><div class="small">Phone: ${escapeHtml(p.phone||'-')}</div><div class="small">Email: ${escapeHtml(p.email||'-')}</div><div class="small">L∆∞u: ${new Date(p.saved).toLocaleString()}</div>`;
  document.getElementById('profileName').value = p.name||''; document.getElementById('profilePhone').value = p.phone||''; document.getElementById('profileEmail').value = p.email||'';
}

/* ======= Reviews tab ======= */
async function addReview(){
  const stars = Number(document.getElementById('reviewStars').value);
  const text = document.getElementById('reviewText').value.trim();
  const f = document.getElementById('reviewFile').files[0];
  let img = null;
  if(f){
    try{ img = await new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res({name:f.name,type:f.type,data:fr.result}); fr.onerror=rej; fr.readAsDataURL(f); }); }catch(e){ notify('L·ªói ƒë·ªçc ·∫£nh'); return; }
  }
  const r = { id: uid(), stars, text, img, created: new Date().toISOString(), likes:0, dislikes:0, loves:0, comments: [] };
  data.reviews.unshift(r);
  if(save(KEY.DATA,data)){ document.getElementById('reviewText').value=''; document.getElementById('reviewFile').value=''; notify('ƒê√£ g·ª≠i ƒë√°nh gi√°'); renderReviews(); }
}
function renderReviews(){
  const container = document.getElementById('reviewsList'); container.innerHTML='';
  for(const r of data.reviews){
    const d = document.createElement('div'); d.className='post';
    let html = `<div class="meta"><strong>${'‚òÖ'.repeat(r.stars)}${'‚òÜ'.repeat(5-r.stars)}</strong> <span class="small">‚Ä¢ ${new Date(r.created).toLocaleString()}</span></div>`;
    html += `<div>${escapeHtml(r.text||'')}</div>`;
    if(r.img) html += `<div class="mediaRow"><img class="preview" src="${r.img.data}" alt="${escapeHtml(r.img.name)}"></div>`;
    html += `<div class="actions">
      <button class="reaction" onclick="reviewReact('${r.id}','likes')">üëç <span class="small">${r.likes}</span></button>
      <button class="reaction" onclick="reviewReact('${r.id}','dislikes')">üëé <span class="small">${r.dislikes}</span></button>
      <button class="reaction" onclick="reviewReact('${r.id}','loves')">‚ù§Ô∏è <span class="small">${r.loves}</span></button>
      <div style="margin-left:auto"><button class="btn ghost danger" onclick="deleteReview('${r.id}')">X√≥a</button></div>
    </div>`;
    html += `<div class="comment-box" id="rv_cbox_${r.id}">
      <div id="rv_list_${r.id}"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <input id="rv_name_${r.id}" placeholder="T√™n (t√πy √Ω)" style="flex:0 0 180px">
        <input id="rv_text_${r.id}" placeholder="B√¨nh lu·∫≠n..." style="flex:1">
        <button class="btn" onclick="addReviewComment('${r.id}')">G·ª≠i</button>
      </div>
    </div>`;
    d.innerHTML = html; container.appendChild(d);
    renderReviewComments(r.id);
  }
}
function reviewReact(id, field){ const r = data.reviews.find(x=>x.id===id); if(!r) return; r[field] = (r[field]||0)+1; if(save(KEY.DATA,data)) renderReviews(); }
function deleteReview(id){ if(!confirm('X√≥a ƒë√°nh gi√°?')) return; data.reviews = data.reviews.filter(x=>x.id!==id); if(save(KEY.DATA,data)) renderReviews(); }

/* review comments */
function addReviewComment(reviewId){
  const name = (document.getElementById(`rv_name_${reviewId}`).value||'').trim() || getDefaultName();
  const text = (document.getElementById(`rv_text_${reviewId}`).value||'').trim();
  if(!text) return notify('Vi·∫øt b√¨nh lu·∫≠n');
  const r = data.reviews.find(x=>x.id===reviewId); if(!r) return;
  r.comments.push({ id: uid(), name, text, t: new Date().toISOString(), likes:0, dislikes:0, loves:0 });
  if(save(KEY.DATA,data)){ document.getElementById(`rv_name_${reviewId}`).value=''; document.getElementById(`rv_text_${reviewId}`).value=''; renderReviewComments(reviewId); }
}
function renderReviewComments(reviewId){
  const r = data.reviews.find(x=>x.id===reviewId);
  const box = document.getElementById(`rv_list_${reviewId}`);
  if(!r){ box.innerHTML=''; return; }
  box.innerHTML='';
  for(const c of r.comments){
    const el = document.createElement('div'); el.className='comment';
    el.innerHTML = `<div><b>${escapeHtml(c.name)}</b> ‚Ä¢ <span class="small">${new Date(c.t).toLocaleString()}</span><div>${escapeHtml(c.text)}</div></div>
      <div style="text-align:right;min-width:160px">
        <button class="reaction" onclick="reviewCommentReact('${reviewId}','${c.id}','likes')">üëç <span class="small">${c.likes||0}</span></button>
        <button class="reaction" onclick="reviewCommentReact('${reviewId}','${c.id}','dislikes')">üëé <span class="small">${c.dislikes||0}</span></button>
        <button class="reaction" onclick="reviewCommentReact('${reviewId}','${c.id}','loves')">‚ù§Ô∏è <span class="small">${c.loves||0}</span></button>
        <div style="margin-top:6px"><button class="btn ghost danger" onclick="deleteReviewComment('${reviewId}','${c.id}')">X√≥a</button></div>
      </div>`;
    box.appendChild(el);
  }
}
function reviewCommentReact(rid,cid,field){
  const r = data.reviews.find(x=>x.id===rid); if(!r) return; const c = r.comments.find(x=>x.id===cid); if(!c) return;
  c[field] = (c[field]||0)+1; if(save(KEY.DATA,data)) renderReviewComments(rid);
}
function deleteReviewComment(rid,cid){ if(!confirm('X√≥a b√¨nh lu·∫≠n?')) return; const r = data.reviews.find(x=>x.id===rid); if(!r) return; r.comments = r.comments.filter(x=>x.id!==cid); if(save(KEY.DATA,data)) renderReviewComments(rid); }

/* ======= Settings (auth & apply) ======= */
function doLogin(){
  const u=document.getElementById('loginUser').value.trim();
  const p=document.getElementById('loginPass').value;
  if(u===AUTH.user && p===AUTH.pass){ sessionStorage.setItem('wol_logged','1'); document.getElementById('loginStatus').innerText='ƒê√£ ƒëƒÉng nh·∫≠p'; notify('ƒêƒÉng nh·∫≠p th√†nh c√¥ng'); }
  else notify('Sai t√†i kho·∫£n/m·∫≠t kh·∫©u');
}
function doLogout(){ sessionStorage.removeItem('wol_logged'); document.getElementById('loginStatus').innerText='Ch∆∞a ƒëƒÉng nh·∫≠p'; notify('ƒê√£ ƒëƒÉng xu·∫•t'); }
function isLogged(){ return sessionStorage.getItem('wol_logged')==='1' }

async function applySettings(){
  if(!isLogged()) return notify('C·∫ßn ƒëƒÉng nh·∫≠p');
  const newTitle = document.getElementById('newTitle').value.trim();
  const file = document.getElementById('bgFile').files[0];
  const url = document.getElementById('bgUrl') ? document.getElementById('bgUrl').value.trim() : '';
  if(newTitle){ settings.title = newTitle; document.getElementById('siteTitle').innerText = newTitle; }
  if(file){
    try{
      const dataUrl = await new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); });
      settings.bg = dataUrl; document.body.style.backgroundImage = `url('${dataUrl}')`;
    }catch(e){ notify('L·ªói ƒë·ªçc file n·ªÅn'); return; }
  } else if(url){
    settings.bg = url; document.body.style.backgroundImage = `url('${url}')`;
  }
  save(KEY.SETTINGS, settings); notify('C√†i ƒë·∫∑t ƒë√£ l∆∞u');
}

/* ======= Export / Import / Wipe ======= */
function exportData(){
  const blob = new Blob([JSON.stringify({data,settings,defaultName: load(KEY.DEFAULT_NAME)||null})], {type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='wol_backup.json'; a.click();
}
function importData(e){
  const f = e.target.files[0]; if(!f) return;
  const fr = new FileReader();
  fr.onload = ev => {
    try{
      const obj = JSON.parse(ev.target.result);
      if(obj.data){ data = obj.data; settings = obj.settings || settings; if(obj.defaultName) save(KEY.DEFAULT_NAME,obj.defaultName; ) }
      else { data = obj; } // support older single-obj backups
      save(KEY.DATA,data); save(KEY.SETTINGS,settings); notify('ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu'); renderAll();
    }catch(err){ notify('File kh√¥ng h·ª£p l·ªá'); console.error(err); }
  };
  fr.readAsText(f);
}
function wipeAll(){ if(!confirm('X√≥a to√†n b·ªô d·ªØ li·ªáu localStorage?')) return; localStorage.removeItem(KEY.DATA); localStorage.removeItem(KEY.SETTINGS); localStorage.removeItem(KEY.DEFAULT_NAME); data = {media:[],profile:null,reviews:[]}; settings = {title:document.getElementById('siteTitle').innerText,bg:null}; renderAll(); notify('ƒê√£ x√≥a to√†n b·ªô'); }

/* ======= Render helpers ======= */
function renderAll(){ renderMediaPosts(); renderProfile(); renderReviews(); }
function renderProfile(){ renderProfile(); } // keep call consistent

function renderProfile(){
  const p = data.profile;
  const el = document.getElementById('profileShow');
  if(!p){ el.innerText = 'Ch∆∞a c√≥ th√¥ng tin.'; document.getElementById('profileName').value=''; document.getElementById('profilePhone').value=''; document.getElementById('profileEmail').value=''; return; }
  el.innerHTML = `<div><b>${escapeHtml(p.name)}</b></div><div class="small">Phone: ${escapeHtml(p.phone||'-')}</div><div class="small">Email: ${escapeHtml(p.email||'-')}</div><div class="small">L∆∞u: ${new Date(p.saved).toLocaleString()}</div>`;
  document.getElementById('profileName').value = p.name||''; document.getElementById('profilePhone').value = p.phone||''; document.getElementById('profileEmail').value = p.email||'';
}

/* ======= Utilities ======= */
function escapeHtml(t){ if(!t) return ''; return String(t).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;') }

/* ======= Init on load ======= */
(function init(){
  // apply settings
  if(settings.title) document.getElementById('siteTitle').innerText = settings.title;
  if(settings.bg) document.body.style.backgroundImage = `url('${settings.bg}')`;
  // default name
  const dn = load(KEY.DEFAULT_NAME); if(dn) document.getElementById('defaultName').value = dn;
  // initial render
  renderAll();
})();
</script>
</body>
</html>
