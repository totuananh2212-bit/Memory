<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini Soccer 2D</title>
  <style>
    body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; }
    #menu, #gameUI { text-align: center; margin-top: 20px; }
    canvas { display: block; margin: 10px auto; background: green; }
    .hidden { display: none; }
    input, select, button { margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <div id="menu">
    <h1>⚽ Mini Soccer 2D</h1>
    <label>Đội 1: <input id="team1Name" value="Team A"></label>
    <label>Áo: <input id="team1Color" type="color" value="#ff0000"></label><br>
    <label>Đội 2: <input id="team2Name" value="Team B"></label>
    <label>Áo: <input id="team2Color" type="color" value="#0000ff"></label><br>
    <label>Thời gian (phút): 
      <select id="matchTime">
        <option value="1">1</option>
        <option value="3" selected>3</option>
        <option value="5">5</option>
      </select>
    </label><br>
    <button id="startBtn">Bắt đầu trận</button>
  </div>

  <div id="gameUI" class="hidden">
    <div id="scoreboard"></div>
    <div id="timer"></div>
    <button onclick="togglePause()">Pause (P)</button>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
  </div>

  <audio id="crowd" loop>
    <source src="https://actions.google.com/sounds/v1/crowd/crowd_cheer.ogg" type="audio/ogg">
  </audio>

  <script>
    let canvas, ctx;
    let gameInterval, timerInterval;
    let isPaused = false;
    let matchSeconds = 0;
    let timeLeft = 0;

    const players = [];
    const ball = { x: 400, y: 250, radius: 7, vx: 0, vy: 0, owner: null };

    function createTeam(color, side) {
      const team = [];
      const baseX = side === "left" ? 200 : 600;
      for (let i = 0; i < 5; i++) {
        team.push({
          x: baseX + (Math.random()*100 - 50),
          y: 100 + i*80,
          radius: 12,
          color,
          role: i === 0 ? "GK" : "FW",
          speed: 2
        });
      }
      return team;
    }

    let team1, team2;
    let score = [0,0];

    function startGame(){
      document.getElementById("menu").classList.add("hidden");
      document.getElementById("gameUI").classList.remove("hidden");

      canvas = document.getElementById("gameCanvas");
      ctx = canvas.getContext("2d");

      const team1Color = document.getElementById("team1Color").value;
      const team2Color = document.getElementById("team2Color").value;
      team1 = createTeam(team1Color, "left");
      team2 = createTeam(team2Color, "right");
      players.splice(0, players.length, ...team1, ...team2);

      score = [0,0];
      updateScoreboard();

      matchSeconds = parseInt(document.getElementById("matchTime").value) * 60;
      timeLeft = matchSeconds;
      timerInterval = setInterval(updateTimer, 1000);

      document.getElementById("crowd").play();

      gameInterval = setInterval(gameLoop, 1000/60);
    }

    function updateScoreboard(){
      document.getElementById("scoreboard").innerText = 
        document.getElementById("team1Name").value + " " + score[0] +
        " - " + score[1] + " " + document.getElementById("team2Name").value;
    }

    function updateTimer(){
      if (!isPaused){
        timeLeft--;
        document.getElementById("timer").innerText = 
          "⏱️ " + Math.floor(timeLeft/60) + ":" + (timeLeft%60).toString().padStart(2,"0");
        if (timeLeft<=0){ endGame(); }
      }
    }

    function endGame(){
      clearInterval(gameInterval);
      clearInterval(timerInterval);
      alert("Kết thúc trận! Tỉ số: " + score[0] + "-" + score[1]);
      location.reload();
    }

    function togglePause(){
      isPaused = !isPaused;
    }

    function gameLoop(){
      if (isPaused) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawField();
      moveBall();
      drawPlayers();
      drawBall();
    }

    function drawField(){
      ctx.fillStyle = "#2e8b57";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.strokeStyle = "white";
      ctx.lineWidth = 2;
      ctx.strokeRect(50,50,700,400);
      ctx.beginPath();
      ctx.arc(400,250,70,0,Math.PI*2);
      ctx.stroke();
    }

    function drawPlayers(){
      players.forEach(p=>{
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
        ctx.fill();
      });
    }

    function drawBall(){
      ctx.fillStyle = "white";
      ctx.beginPath();
      ctx.arc(ball.x,ball.y,ball.radius,0,Math.PI*2);
      ctx.fill();
    }

    function moveBall(){
      if (ball.owner){
        ball.x = ball.owner.x;
        ball.y = ball.owner.y;
      } else {
        ball.x += ball.vx;
        ball.y += ball.vy;
        ball.vx *= 0.98;
        ball.vy *= 0.98;
      }
    }

    // Keyboard test
    document.addEventListener("keydown", e=>{
      if (e.key==="p"||e.key==="P") togglePause();
    });

    // Liên kết nút Start
    document.getElementById("startBtn").addEventListener("click", startGame);
  </script>
</body>
</html>






